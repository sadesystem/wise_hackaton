<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./vars.css">
  <link rel="stylesheet" href="./style.css">
  <title>Goal Jar Tree View</title>
  <style>
    a, button, input, select, h1, h2, h3, h4, h5, * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      border: none;
      text-decoration: none;
      background: none;
      -webkit-font-smoothing: antialiased;
    }
    menu, ol, ul { list-style-type: none; margin: 0; padding: 0; }
    html, body { height: 100%; margin: 0; }
    body { background: #e5e5e5; }
    .center-shell {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Fix percentage positioning */
    .div8 {
      background: rgba(0, 0, 0, 0);
      width: 72.9px;
      height: 60.63px;
      position: absolute;
      left: 284px !important;  /* Move it to the right */
      top: 12px !important;    /* Align with icon */
    }

    /* Make navigation clickable */
    .bottom-nav-icons,
    .vector,
    .savings,
    .home3,
    .savings2,
    .home4 {
      cursor: pointer;
    }

    /* Add hover effect */
    .vector:hover,
    .savings:hover,
    .home4:hover {
      opacity: 0.7;
    }
  </style>
</head>
<body>
<div class="center-shell">
  <div class="goal-jar-tree-view">
    <div class="device-device-frame">
      <div class="device-device-frame-components-status-bar">
        <div class="time">9:30</div>
        <img class="right-icons" src="right-icons0.svg" />
        <img class="camera-cutout" src="camera-cutout0.svg" />
      </div>
      <div class="device-device-frame-components-navigation">
        <div class="home"></div>
      </div>
    </div>

    <!-- Leaf image -->
    <img class="image-1" src="leaf_image_1.png" />

    <!-- Chip buttons -->
    <div class="chip-button"><div class="all">+5â‚¬</div></div>
    <div class="chip-button2"><div class="all2">+10â‚¬</div></div>
    <div class="chip-button3"><div class="all2">Custom</div></div>

    <!-- Goal Card Structure -->
    <div class="button">
      <div class="div">
        <div class="div2">
          <div class="div3">
            <div class="div4">ðŸŽ¨</div>
          </div>
          <div class="div5">
            <div class="div6">
              <div class="art-supplies">Loading...</div>
            </div>
            <div class="div7"></div>
          </div>
          <div class="div8">
            <div class="_0">0%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Motivation / primary button -->
    <div class="primary-button">
      <div class="next">Keep going!</div>
    </div>

    <!-- Bottom nav - Made clickable -->
    <div class="bottom-nav-icons" onclick="window.location.href='../html/transactions.html'">
      <div class="home2">History</div>
    </div>
    <img class="vector" src="history_image.svg" onclick="window.location.href='../html/transactions.html'" />

    <img class="savings" src="savings_image.svg" onclick="window.location.href='../html/saving.html'" />
    <div class="savings2" onclick="window.location.href='../html/saving.html'">Savings</div>

    <img class="home4" src="home_image.svg" onclick="window.location.href='../html/main.html'" />
    <div class="home3" onclick="window.location.href='../html/main.html'">Home</div>
  </div>
</div>

<script>
  async function loadGoalDetail() {
    console.log("Script started");

    const urlParams = new URLSearchParams(window.location.search);
    const jarId = parseInt(urlParams.get('id'));

    console.log("Jar ID from URL:", jarId);

    if (!jarId) {
      console.error("No jar ID provided in URL");
      // Redirect back to savings page if no ID
      window.location.href = '../html/saving.html';
      return;
    }

    try {
      const response = await fetch("../data/jars.json");
      const data = await response.json();
      const jar = data.jars.find(j => j.id === jarId);

      if (!jar) {
        console.error("Jar not found with ID:", jarId);
        window.location.href = '../html/saving.html';
        return;
      }

      const percent = ((jar.current / jar.goal) * 100).toFixed(0);
      const icon = jar.icon;

      // Update the display
      document.querySelector('.div4').textContent = icon;
      document.querySelector('.art-supplies').textContent = jar.name;
      document.querySelector('._0').textContent = `${percent}%`;

      console.log("Successfully updated goal display");

    } catch (error) {
      console.error("Error loading goal:", error);
    }
  }

  // Update the time
  function updateTime() {
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    document.querySelector('.time').textContent = `${hours}:${minutes}`;
  }

  loadGoalDetail();
  updateTime();
</script>
</body>
</html>