<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savings Goals</title>
    <link rel="stylesheet" href="../assets/css/saving.css">
</head>
<body>
<div class="app-frame">

    <!-- Header -->
    <header class="header">
        <h1>Saving Goals üéØ</h1>
    </header>

    <!-- Add Goal Popup -->
    <div class="add-goal-popup" id="addGoalPopup">
        <div class="popup-content">
            <h3>Add New Goal</h3>
            <input type="text" id="goalName" placeholder="Goal name">
            <input type="number" id="goalAmount" placeholder="Target amount">
            <div class="popup-buttons">
                <button id="cancelBtn">Cancel</button>
                <button id="saveBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Goal Card 1 -->
    <section class="goal-card">
        <div class="goal-header">
            <div class="goal-icon">üé®</div>
            <div class="goal-info">
                <div class="goal-title">Art Supplies</div>
                <div class="goal-target">Target: 50‚Ç¨</div>
            </div>
            <div class="goal-progress">0%</div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width:0%"></div>
        </div>
        <div class="goal-stats">
            <span class="saved">Saved: 0.00‚Ç¨</span>
            <span class="need">Need: 50.00‚Ç¨</span>
        </div>
    </section>

    <!-- Goal Card 2 -->
    <section class="goal-card">
        <div class="goal-header">
            <div class="goal-icon">üö≤</div>
            <div class="goal-info">
                <div class="goal-title">New Bike</div>
                <div class="goal-target">Target: 150‚Ç¨</div>
            </div>
            <div class="goal-progress">30%</div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width:30%"></div>
        </div>
        <div class="goal-stats">
            <span class="saved">Saved: 45.50‚Ç¨</span>
            <span class="need">Need: 104.50‚Ç¨</span>
        </div>
    </section>

    <div class="add-goal-btn">
        <button id="addGoalBtn">+ Add Goal</button>
    </div>

    <!-- Motivation Card -->
    <section class="motivation-card">
        <div class="motivation-icon">üåü</div>
        <h2>Keep saving!</h2>
        <p>Every time you don‚Äôt spend, you‚Äôre closer to your goals. You‚Äôve got this! üí™</p>
    </section>

    <!-- Bottom Navigation -->
    <!-- navigation bar -->
    <div class="bottom-nav">

        <a href="../html/transactions.html" class="nav-item">
            <img src="../assets/images/vector0.svg" class="nav-icon">
            <div class="nav-label">History</div>
        </a>

        <a href="../html/main.html" class="nav-item">
            <img src="../assets/images/home3.svg" class="nav-icon">
            <div class="nav-label">Home</div>
        </a>

        <a href="../html/saving.html" class="nav-item">
            <img src="../assets/images/savings0.svg" class="nav-icon">
            <div class="nav-label">Savings</div>
        </a>

    </div>

</div>

<script>
    async function loadGoals() {
        const response = await fetch("../data/jars.json");
        const data = await response.json();
        const container = document.querySelector(".app-frame");

        // Remove the existing static goal cards
        document.querySelectorAll(".goal-card").forEach(card => card.remove());

        data.jars.forEach(jar => {
            const percent = ((jar.current / jar.goal) * 100).toFixed(0);
            const need = (jar.goal - jar.current).toFixed(2);

            const card = document.createElement("section");
            card.classList.add("goal-card");
            card.style.cursor = "pointer";

            card.innerHTML = `
            <div class="goal-header">
                <div class="goal-icon">${jar.name.includes("art") ? "üé®" : "üö≤"}</div>
                <div class="goal-info">
                    <div class="goal-title">${jar.name}</div>
                    <div class="goal-target">Target: ${jar.goal}‚Ç¨</div>
                </div>
                <div class="goal-progress">${percent}%</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width:${percent}%"></div>
            </div>
            <div class="goal-stats">
                <span class="saved">Saved: ${jar.current.toFixed(2)}‚Ç¨</span>
                <span class="need">Need: ${need}‚Ç¨</span>
            </div>
        `;

            // CLICK ‚Üí go to goal details page
            card.addEventListener("click", () => {
                window.location.href = `../jar_progress_bar/jar_progress.html?id=${jar.id}`;
            });

            container.insertBefore(card, document.querySelector(".motivation-card"));
        });
    }

    loadGoals();


    document.addEventListener("DOMContentLoaded", () => {
        const addBtn = document.getElementById("addGoalBtn");
        const popup = document.getElementById("addGoalPopup");
        const cancelBtn = document.getElementById("cancelBtn");
        const saveBtn = document.getElementById("saveBtn");

        addBtn.addEventListener("click", () => {
            popup.style.display = "flex"; // show popup
        });

        cancelBtn.addEventListener("click", () => {
            popup.style.display = "none"; // hide popup
        });

        saveBtn.addEventListener("click", async () => {
            const name = document.getElementById("goalName").value.trim();
            const goalAmount = parseFloat(document.getElementById("goalAmount").value);

            if (!name || isNaN(goalAmount)) {
                alert("Please enter valid goal name and amount.");
                return;
            }

            // Load existing jars
            const response = await fetch("../data/jars.json");
            const data = await response.json();

            // Create new jar
            const newId = data.jars.length ? Math.max(...data.jars.map(j => j.id)) + 1 : 1;
            const newJar = {
                id: newId,
                name: name.toLowerCase(),
                goal: goalAmount,
                current: 0
            };

            data.jars.push(newJar);

            // Update DOM immediately
            const container = document.querySelector(".app-frame");
            const percent = 0;

            const card = document.createElement("section");
            card.classList.add("goal-card");
            card.style.cursor = "pointer";

            card.innerHTML = `
                <div class="goal-header">
                    <div class="goal-icon">${name.toLowerCase().includes("art") ? "üé®" : "üö≤"}</div>
                    <div class="goal-info">
                        <div class="goal-title">${name}</div>
                        <div class="goal-target">Target: ${goalAmount}‚Ç¨</div>
                    </div>
                    <div class="goal-progress">${percent}%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width:${percent}%"></div>
                </div>
                <div class="goal-stats">
                    <span class="saved">Saved: 0.00‚Ç¨</span>
                    <span class="need">Need: ${goalAmount.toFixed(2)}‚Ç¨</span>
                </div>
            `;

            card.addEventListener("click", () => {
                window.location.href = `../jar_progress_bar/jar_progress.html?id=${newId}`;
            });

            container.insertBefore(card, document.querySelector(".motivation-card"));

            // Hide popup and reset form
            popup.style.display = "none";
            document.getElementById("goalName").value = "";
            document.getElementById("goalAmount").value = "";

            // ‚ö†Ô∏è NOTE: We cannot actually save to jars.json from browser JS without a backend
            // For a real app, you need a server-side endpoint to write the file
            console.log("New jar added:", newJar);
        });
    });

</script>
</body>
</html>
